replicaCount: 1

fullnameOverride: "minio"

image:
  repository: minio/minio
  pullPolicy: IfNotPresent
  tag: "RELEASE.2024-01-16T16-07-38Z"

# Service configuration
service:
  type: ClusterIP
  port: 9000
  consolePort: 9001

# External URL configuration (required by template)
url:
  hostname: "minio-staging.openup.org.za" # ilifu/staging

# Console configuration
console:
  url:
    hostname: "minio-console-staging.openup.org.za"  # ilifu/staging
  ingress:
    enabled: true
    className: "private"
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "1000m"
    tls: []

# Main MinIO ingress - SIMPLIFIED VERSION
ingress:
  enabled: true
  className: "private"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "1000m"
    nginx.ingress.kubernetes.io/proxy-request-buffering: "off"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
  hosts:
    - host: minio-staging.openup.org.za  # ilifu/staging
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: minio-staging-tls-cert #ilifu/staging
      hosts:
        - minio-staging.openup.org.za #ilifu/staging

# Environment variables for MinIO
extraEnv:
  - name: MINIO_SERVER_URL
    value: "https://minio-staging.openup.org.za"  # ilifu/staging

# MinIO configuration
minio:
  accessKey: admin
  secretKey: admin123
  
  # Buckets to create
  buckets:
    - name: state
    - name: object
    - name: agari-data
  
  # Enable bucket setup
  bucketSetup:
    enabled: true

# Resource limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Persistence
persistence:
  enabled: true
  size: 10Gi
  accessMode: ReadWriteOnce
  storageClass: ""

# Health checks
probes:
  liveness:
    enabled: true 
    httpGet:
      path: /minio/health/live
      port: api
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  readiness:
    enabled: true
    httpGet:
      path: /minio/health/ready
      port: api
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Security context
podSecurityContext: 
  fsGroup: 1000

securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true

# Service account
serviceAccount:
  create: false
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# MinIO Client for bucket setup
mc:
  image:
    repository: minio/mc
    tag: "RELEASE.2024-01-13T08-44-48Z"

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}
