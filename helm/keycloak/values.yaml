replicaCount: 1

url:
  hostname: "keycloak-staging.openup.org.za" # ilifu/staging

image:
  repository: quay.io/phasetwo/phasetwo-keycloak
  pullPolicy: IfNotPresent
  tag: "26.2.5"

nameOverride: ""
fullnameOverride: "keycloak"

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  className: "private"
  annotations:
    nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
    nginx.ingress.kubernetes.io/proxy-buffering: "on"
    nginx.ingress.kubernetes.io/proxy-buffers-number: "20"
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization"
  hosts:
    - host: keycloak-staging.openup.org.za  # ilifu/staging
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: keycloak-staging-tls-cert # ilifu/staging
      hosts:
        - keycloak-staging.openup.org.za # ilifu/staging

extraEnv:
  - name: KC_FEATURES
    value: "preview"
  - name: KC_HOSTNAME_STRICT
    value: "false"
  - name: KC_HOSTNAME_STRICT_HTTPS
    value: "false"
  - name: JAVA_OPTS_APPEND
    value: "-Djava.awt.headless=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.net.preferIPv4Stack=true -server -Xms512m -Xmx768m"
  - name: KC_HOSTNAME
    value: keycloak-staging.openup.org.za  # ilifu/staging
  - name: KC_PROXY
    value: "edge"
  - name: KC_CORS_ORIGINS
    value: "*"
  - name: KC_SPI_EMAIL_TEMPLATE_PROVIDER
    value: freemarker

probes:
  liveness:
    enabled: false
  readiness:
    enabled: true
    tcpSocket:
      port: 8080
    initialDelaySeconds: 120 
    periodSeconds: 30
    timeoutSeconds: 15
    failureThreshold: 12

keycloak:
  database:
    vendor: postgres
    host: keycloak-db
    port: 5432
    database: keycloakDb
    username: admin
    password: keycloak-db-pass-123
  
  # Admin user
  admin:
    username: admin
    password: admin123
  
  # Keycloak settings
  hostname: keycloak-staging.openup.org.za # ilifu/staging
  healthEnabled: true
  startupMode: start-dev
  frontendUrl: "https://keycloak-staging.openup.org.za" # ilifu/staging
  adminUrl: "https://keycloak-staging.openup.org.za" # ilifu/staging

# Resource limits - better configuration from values-keycloak.yaml
resources:
  limits:
    cpu: 500m
    memory: 1Gi
    ephemeral-storage: "4Gi"
  requests:
    cpu: 200m
    memory: 512Mi
    ephemeral-storage: "2Gi"

# Node selection
nodeSelector: {}
tolerations: []
affinity: {}

# Pod security context
podSecurityContext: {}
securityContext: {}

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# Autoscaling (disabled by default)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
