# Test users from AGARI realm
@username = testuser
# @username = orgadmin
# @username = orgcontrib
# @username = orgviewer
# @username = projectadmin
# @username = projectcontrib
# @username = projectviewer
@password = password123
@realm = agari
@query_realm = agari
@client_id = song-client
@client_secret = hVRE3H3WO5E7cysTo7KC0qJBeBWXb4tH

### TEST with admin-cli (should always work)
# @name adminLogin
# POST http://keycloak.local/realms/{{realm}}/protocol/openid-connect/token
# Content-Type: application/x-www-form-urlencoded

# username={{username}}
# &password={{password}}
# &grant_type=password
# &client_id=admin-cli

### LOGIN with project client

# @name login
POST http://keycloak.local/realms/{{realm}}/protocol/openid-connect/token
Content-Type: application/x-www-form-urlencoded

username={{username}}
&password={{password}}
&grant_type=password
&client_id={{client_id}}
&client_secret={{client_secret}}






###

@token = {{login.response.body.access_token}}
@refresh_token = {{login.response.body.refresh_token}}

### LOGOUT

POST http://keycloak.local/realms/{{realm}}/protocol/openid-connect/logout
Content-Type: application/x-www-form-urlencoded

client_id={{client_id}}
&client_secret={{client_secret}}
&refresh_token={{refresh_token}}

### SONG API Tests

### Get all studies (works!)
GET http://song.local/studies/all
Authorization: Bearer {{token}}

### Get study by ID
GET http://song.local/studies/study1
Authorization: Bearer {{token}}

### Create a new study (requires admin/contributor role)
### Try different POST endpoints
POST http://song.local/studies/study1/
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "studyId": "study1",
  "name": "AGARI Test Study", 
  "description": "Test study for RBAC validation",
  "organization": "NICD",
  "info": {
    "projectType": "genomics",
    "region": "South Africa"
  }
}

### Get analyses for a study
GET http://song.local/studies/study1/analysis/
Authorization: Bearer {{token}}

### Submit analysis metadata (requires contributor role)
POST http://song.local/submit/study1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "studyId": "study1",
  "analysisType": {
    "name": "sequencing_read",
    "version": 1
  },
  "samples": [
    {
      "sampleId": "SA001",
      "sampleType": "DNA",
      "specimen": {
        "specimenId": "SP001",
        "specimenType": "Normal",
        "specimenTissueSource": "Blood"
      },
      "donor": {
        "donorId": "D001",
        "studyId": "cholera",
        "donorSubmitterId": "patient-001",
        "donorGender": "male"
      }
    }
  ]
}


eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJPZ0tPVWZOWjMyUEYxdkcxRXo2aXg1XzY4U0V6cFlwUHA5UVpxZmcyY1o0In0.eyJleHAiOjE3NTUwMjA1NTYsImlhdCI6MTc1NTAyMDI1NiwianRpIjoib25ydHJvOjExZWZmNDhjLTM1YjgtYTBlYS0zNDMzLTcwNWQ0NDhlZmNiYyIsImlzcyI6Imh0dHA6Ly9rZXljbG9hay5sb2NhbC9yZWFsbXMvYWdhcmkiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiYTVmOTM3Y2UtMjkyZi00YzExLWFiYTItYzljYjQwZTJhYjRmIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoic29uZy1jbGllbnQiLCJzaWQiOiI3NjIzNjc5OC00NTk3LTQ4NjItOWJjNi0yYjI0ZmM2NDBjY2EiLCJhY3IiOiIxIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbInNvbmcuUkVBRCIsIlNUVURZLnN0dWR5MS5XUklURSIsImNvbnRyaWJ1dG9yIiwic29uZy5XUklURSJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyJdfX0sInNjb3BlIjoicHJvZmlsZSBlbWFpbCIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwibmFtZSI6IlRlc3QgVXNlciIsImNvbnRleHQiOnsic2NvcGUiOlsic29uZy5SRUFEIiwiU1RVRFkuc3R1ZHkxLldSSVRFIiwiY29udHJpYnV0b3IiLCJzb25nLldSSVRFIl19LCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ0ZXN0dXNlciIsImdpdmVuX25hbWUiOiJUZXN0IiwiZmFtaWx5X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0QGFnYXJpLm9yZyJ9.zSs4TN_lG9a8OynKUyU-Dp-pulO3bIe6j1LaKBLu7j1_J5dS6W3XY_xah7jHByp1GemZlw3rzTf-8nhD_AI2ymsPZHTV_UEbHhtEL0BwVgWdyRZVtZ7PrbAY6dypG-PqI_1K7-o1y_ObuSNhyxe1wduzARmowjpWbVZG15_dVcibgP3joE1Tb2U_PWquIrICIQLR0FH2OUXrL73UnJR2fALAuQdjrh9hWi0ll3KVIolCvAKtZV7_B4mcGYxYgLbF-qU8O5uUqcaxCYD_OsvjKByeCfQRxS1lRbhdX5dqL37e9fQyyCN7mi08tw3maKjaoDBQvQJEKjp2BOjn_bC10g